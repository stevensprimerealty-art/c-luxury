<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>C-LUXURY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- LOADER -->
  <div class="site-loader">
    <span>C-LUXURY</span>
  </div>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-left">
      <div class="brand">C-LUXURY</div>
    </div>

    <div class="header-right">
      <!-- ‚úÖ SEARCH button now works -->
      <button class="icon-btn" id="searchBtn" aria-label="Search">üîç</button>

      <a href="cart.html" class="icon-btn cart" aria-label="Cart">
        üõí<span class="cart-count">0</span>
      </a>

      <button class="icon-btn menu-toggle" aria-label="Menu">‚ãÆ</button>
    </div>
  </header>

  <!-- SHOP NOW BAR -->
  <a
    href="https://mrcharliestxs.myshopify.com/collections/all"
    target="_blank"
    class="shop-now-bar"
    rel="noopener"
  >
    SHOP NOW ‚Üí
  </a>

  <!-- MENU PANEL -->
  <nav class="menu-panel">
    <a href="index.html">Home</a>
    <a href="collections.html">Collections</a>
    <a href="about.html">About</a>
    <hr />
    <a href="login.html">üë§ Register / Login</a>
  </nav>

  <main class="page">

    <!-- HERO -->
    <section class="home-hero">
      <div class="hero-bg active"></div>
      <div class="hero-bg"></div>

      <div class="hero-content fade-in">
        <div class="brand-mark">
          <h1 id="hero-title">A NEW YEAR<br />CURATED FOR YOU</h1>
        </div>

        <p class="quiet" id="hero-subtext">
          EMBRACE FRESH STYLES AND STATEMENT PIECES<br />
          FROM YOUR FAVORITE BRAND.
        </p>

        <div class="luxury-strip">
          <span>LAGOS</span><span>DYNASTY</span><span>FORM</span><span>CONTROL</span><span>TIMELESS</span>
        </div>

        <div class="hero-nav">
          <button id="prev-slide" aria-label="Previous slide">‚Äπ</button>
          <div class="hero-dots" aria-label="Hero slide dots">
            <span class="dot active" aria-label="Slide 1"></span>
            <span class="dot" aria-label="Slide 2"></span>
            <span class="dot" aria-label="Slide 3"></span>
          </div>
          <button id="next-slide" aria-label="Next slide">‚Ä∫</button>
        </div>
      </div>
    </section>

    <!-- NEW IN COLLECTION -->
    <section class="new-in reveal" id="new-in">
      <h3 class="new-in-sub">NEW IN COLLECTION</h3>
      <h2 class="new-in-title">Dive into our collections</h2>
      <a class="new-in-link" href="collections.html"><em>Shop New In</em></a>

      <div class="new-in-grid">
        <a
          id="product-newin-1"
          class="new-in-card"
          href="https://mrcharliestxs.myshopify.com/products/punk-rock-lip-graphic-tee-2025-skeleton-band-back-print?variant=43781844467763"
          target="_blank"
          rel="noopener"
        >
          <img src="assets/images/punk-rock-tee.jpg" alt="Punk Rock Lip Graphic Tee ‚Äî Skeleton Band Back Print" />
          <h4 class="new-in-name">Punk Rock Lip Graphic Tee ‚Äî Skeleton Band Back Print</h4>
          <p class="new-in-price" data-money data-usd="22.26">$22.26</p>
        </a>

        <a
          id="product-newin-2"
          class="new-in-card"
          href="https://mrcharliestxs.myshopify.com/products/slide-sandals-blue-neon-wolf-graphic-removable-strap-slides?variant=43781873827891"
          target="_blank"
          rel="noopener"
        >
          <img src="assets/images/blue-neon-wolf-slides.jpg" alt="Slide Sandals ‚Äî Blue Neon Wolf Graphic Removable-Strap Slides" />
          <h4 class="new-in-name">Slide Sandals ‚Äî Blue Neon Wolf Graphic Removable-Strap Slides</h4>
          <p class="new-in-price" data-money data-usd="51.76">$51.76</p>
        </a>
      </div>
    </section>

    <!-- FEATURE BANNERS -->
    <section class="feature-banners">
      <a
        href="https://mrcharliestxs.myshopify.com/collections/all"
        target="_blank"
        rel="noopener"
        class="feature-banner reveal"
        style="background-image:url('assets/images/backgrounds/new-release.jpg')"
        aria-label="New Release - Explore now"
      >
        <div class="feature-overlay">
          <span class="feature-eyebrow">NEW RELEASE</span>
          <span class="feature-cta">Explore now</span>
        </div>
      </a>

      <a
        href="https://mrcharliestxs.myshopify.com/collections/all"
        target="_blank"
        rel="noopener"
        class="feature-banner reveal"
        style="background-image:url('assets/images/backgrounds/new-collection.jpg')"
        aria-label="From our new collection - Explore now"
      >
        <div class="feature-overlay">
          <span class="feature-eyebrow">FROM OUR NEW COLLECTION</span>
          <span class="feature-cta">Explore now</span>
        </div>
      </a>
    </section>

    <!-- OWN THE LOOK -->
    <section class="own-look reveal" id="own-look">
      <div class="own-look-head">
        <h3 class="own-look-title">OWN THE LOOK</h3>

        <div class="own-look-nav" aria-label="Own the look navigation">
          <button class="own-look-arrow" id="own-prev" type="button" aria-label="Previous product">‚Äπ</button>

          <div class="own-look-dots" aria-label="Own the look product dots">
            <button class="own-dot active" type="button" aria-label="Product slide 1"></button>
            <button class="own-dot" type="button" aria-label="Product slide 2"></button>
            <button class="own-dot" type="button" aria-label="Product slide 3"></button>
            <button class="own-dot" type="button" aria-label="Product slide 4"></button>
          </div>

          <button class="own-look-arrow" id="own-next" type="button" aria-label="Next product">‚Ä∫</button>
        </div>
      </div>

      <div class="own-look-stage" id="own-swipe">
        <a
          id="own-link"
          class="own-look-card"
          href="https://mrcharliestxs.myshopify.com/products/wolf-wave-graphic-t-shirt-teal-floral-wolf-design?variant=43781864914995"
          target="_blank"
          rel="noopener"
          aria-label="Open product on Shopify"
        >
          <div class="own-look-image">
            <img
              id="own-img"
              src="assets/images/products/wolf-teal-floral.jpg"
              loading="lazy"
              alt="WOLF TEA FLORAL T-SHIRT"
            />
            <div class="own-quickview">QUICK VIEW</div>
          </div>

          <div class="own-look-info">
            <h4 id="own-name">WOLF TEA FLORAL T-SHIRT</h4>
            <p id="own-price" data-money data-usd="38.99">$38.99</p>
          </div>
        </a>
      </div>
    </section>

    <!-- EXPLORE MORE -->
    <section class="explore-more reveal">
      <h3>EXPLORE MORE PRODUCTS</h3>
      <a
        href="https://mrcharliestxs.myshopify.com/collections/all"
        target="_blank"
        rel="noopener"
      >
        Shop All Products
      </a>
    </section>

    <!-- NEW BANNERS (AFTER SHOP ALL PRODUCTS) -->
    <section class="feature-banners">
      <a
        href="https://mrcharliestxs.myshopify.com/products/slide-sandals-blue-neon-wolf-graphic-removable-strap-slides?variant=43781873827891"
        target="_blank"
        rel="noopener"
        class="feature-banner reveal"
        style="background-image:url('assets/images/backgrounds/promo-3.jpg')"
        aria-label="New Releases - Explore now"
      >
        <div class="feature-overlay">
          <span class="feature-eyebrow">NEW RELEASES</span>
          <span class="feature-cta">EXPLORE NOW</span>
        </div>
      </a>

      <a
        href="https://mrcharliestxs.myshopify.com/products/christmas-gingerbread-crewneck-sweatshirt-its-the-sweetest-time-of-the-year?variant=43781849382963"
        target="_blank"
        rel="noopener"
        class="feature-banner reveal"
        style="background-image:url('assets/images/backgrounds/promo-4.jpg')"
        aria-label="From our new collection - Explore now"
      >
        <div class="feature-overlay">
          <span class="feature-eyebrow">FROM OUR NEW COLLECTION</span>
          <span class="feature-cta">EXPLORE NOW</span>
        </div>
      </a>
    </section>

    <!-- FOOTER -->
    <footer class="site-footer reveal">
      <div class="footer-inner">
        <div class="footer-brand">C-LUXURY</div>
        <p class="footer-tagline">
          WHERE HIGH FASHION IS A LIFESTYLE ‚Äî CURATED PIECES, BOLD IDENTITY, TIMELESS ENERGY.
        </p>

        <div class="footer-links">
          <a href="collections.html">Shop</a>
          <a href="about.html">About</a>
          <a href="login.html">Account</a>
        </div>

        <p class="footer-copy">¬© 2026 C-LUXURY. All rights reserved.</p>
      </div>
    </footer>
  </main>

  <!-- ‚úÖ SEARCH OVERLAY + MODAL (WORKING) -->
  <div class="search-overlay" id="searchOverlay" aria-hidden="true"></div>
  <div class="search-modal" id="searchModal" aria-hidden="true" role="dialog" aria-label="Search products">
    <input
      type="search"
      class="search-input"
      id="searchInput"
      placeholder="Search products..."
      autocomplete="off"
      aria-label="Search input"
    />
    <div class="search-results" id="searchResults" aria-label="Search results"></div>
  </div>

  <!-- FLOATING UI: Currency Switch (left) -->
  <div class="floating-ui" aria-label="Floating controls">
    <div class="currency-switch" role="group" aria-label="Currency switch">
      <button type="button" class="currency-btn active" data-currency="USD">USD</button>
      <button type="button" class="currency-btn" data-currency="NGN">NGN</button>
    </div>
  </div>

  <!-- ‚úÖ Chat bubble (right corner, horizontal) -->
  <button type="button" class="chat-bubble" aria-label="Chat with us" id="chatOpenBtn">
    üí¨ <span class="chat-bubble-text">Chat with us</span>
  </button>

  <!-- Chat Panel -->
  <div class="chat-panel" id="chatPanel" aria-hidden="true">
    <div class="chat-head">
      <div class="chat-title">Chat with us</div>
      <button type="button" class="chat-close" id="chatCloseBtn" aria-label="Close chat">‚úï</button>
    </div>

    <div class="chat-body">
      <div class="chat-msg bot">Hi üëã How can we help?</div>
      <div class="chat-msg bot">Tap below to continue shopping.</div>
    </div>

    <div class="chat-actions">
      <a class="chat-action" href="https://mrcharliestxs.myshopify.com/collections/all" target="_blank" rel="noopener">Shop All Products</a>
      <a class="chat-action" href="https://mrcharliestxs.myshopify.com/pages/contact" target="_blank" rel="noopener">Contact</a>
    </div>
  </div>

  <script>
    window.addEventListener("load", () => {

      /* ========================= */
      /* HIDE LOADER               */
      /* ========================= */
      setTimeout(() => {
        const loader = document.querySelector(".site-loader");
        if (loader) loader.classList.add("hidden");
      }, 700);

      /* ========================= */
      /* MENU TOGGLE               */
      /* ========================= */
      const menuToggle = document.querySelector(".menu-toggle");
      const menuPanel = document.querySelector(".menu-panel");
      if (menuToggle && menuPanel) {
        menuToggle.onclick = () => menuPanel.classList.toggle("open");
      }

      /* ========================= */
      /* HERO SLIDER               */
      /* ========================= */
      const heroTitle = document.getElementById("hero-title");
      const heroSubtext = document.getElementById("hero-subtext");
      const heroDots = document.querySelectorAll(".hero-dots .dot");
      const bgLayers = document.querySelectorAll(".hero-bg");
      const heroContent = document.querySelector(".hero-content");

      const slides = [
        { image: "assets/images/hero/hero.PNG",   title: "A NEW YEAR<br>CURATED FOR YOU", text: "EMBRACE FRESH STYLES AND STATEMENT PIECES<br>FROM YOUR FAVORITE BRAND." },
        { image: "assets/images/hero/hero-2.PNG", title: "PRESENCE<br>WITHOUT NOISE",      text: "QUIET CONFIDENCE.<br>DEFINED FORM.<br>TIMELESS CONTROL." },
        { image: "assets/images/hero/hero-3.PNG", title: "WELCOME TO<br>C-LUXURY",         text: "EXPLORE DISTINCTIVE STYLES<br>AS YOU AWAIT WHAT‚ÄôS TO COME." }
      ];

      slides.forEach(s => { const img = new Image(); img.src = s.image; });

      let heroCurrent = 0;
      let activeBg = 0;
      let heroTimer = null;

      function changeHero(index) {
        if (!bgLayers.length || !heroTitle || !heroSubtext || !heroContent) return;

        const nextBg = activeBg === 0 ? 1 : 0;
        heroContent.classList.add("fade-out");

        setTimeout(() => {
          bgLayers[nextBg].style.backgroundImage = `url(${slides[index].image})`;
          bgLayers[nextBg].classList.add("active");
          bgLayers[activeBg].classList.remove("active");
          activeBg = nextBg;

          heroTitle.innerHTML = slides[index].title;
          heroSubtext.innerHTML = slides[index].text;

          heroDots.forEach(d => d.classList.remove("active"));
          if (heroDots[index]) heroDots[index].classList.add("active");

          heroContent.classList.remove("fade-out");
          heroContent.classList.add("fade-in");
        }, 600);
      }

      function stopHeroAuto() {
        if (heroTimer) { clearInterval(heroTimer); heroTimer = null; }
      }

      function startHeroAuto() {
        stopHeroAuto();
        heroTimer = setInterval(() => {
          heroCurrent = (heroCurrent + 1) % slides.length;
          changeHero(heroCurrent);
        }, 6500);
      }

      const nextHeroBtn = document.getElementById("next-slide");
      const prevHeroBtn = document.getElementById("prev-slide");

      if (nextHeroBtn) nextHeroBtn.onclick = () => { heroCurrent = (heroCurrent + 1) % slides.length; changeHero(heroCurrent); startHeroAuto(); };
      if (prevHeroBtn) prevHeroBtn.onclick = () => { heroCurrent = (heroCurrent - 1 + slides.length) % slides.length; changeHero(heroCurrent); startHeroAuto(); };

      heroDots.forEach((dot, i) => {
        dot.onclick = () => { heroCurrent = i; changeHero(heroCurrent); startHeroAuto(); };
      });

      if (bgLayers[0]) bgLayers[0].style.backgroundImage = `url(${slides[0].image})`;
      startHeroAuto();

      /* ========================= */
      /* REVEAL ON SCROLL          */
      /* ========================= */
      const revealEls = document.querySelectorAll(".reveal");
      if (revealEls.length) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.15, rootMargin: "0px 0px -10% 0px" });

        revealEls.forEach(el => observer.observe(el));
      }

      /* ========================= */
      /* OWN THE LOOK SLIDER       */
      /* ========================= */
      const ownDots = document.querySelectorAll(".own-dot");
      const ownImg = document.getElementById("own-img");
      const ownName = document.getElementById("own-name");
      const ownPrice = document.getElementById("own-price");
      const ownLink = document.getElementById("own-link");
      const ownCard = document.querySelector(".own-look-card");
      const ownPrev = document.getElementById("own-prev");
      const ownNext = document.getElementById("own-next");
      const swipeArea = document.getElementById("own-swipe");

      // ‚úÖ Product catalog (used by slider AND search)
      const products = [
        {
          key: "punk-rock-tee",
          name: "Punk Rock Lip Graphic Tee ‚Äî Skeleton Band Back Print",
          priceUSD: 22.26,
          img: "assets/images/punk-rock-tee.jpg",
          link: "https://mrcharliestxs.myshopify.com/products/punk-rock-lip-graphic-tee-2025-skeleton-band-back-print?variant=43781844467763",
          onPageId: "product-newin-1"
        },
        {
          key: "blue-neon-wolf-slides",
          name: "Slide Sandals ‚Äî Blue Neon Wolf Graphic Removable-Strap Slides",
          priceUSD: 51.76,
          img: "assets/images/blue-neon-wolf-slides.jpg",
          link: "https://mrcharliestxs.myshopify.com/products/slide-sandals-blue-neon-wolf-graphic-removable-strap-slides?variant=43781873827891",
          onPageId: "product-newin-2"
        },
        {
          key: "wolf-teal-floral",
          name: "WOLF TEA FLORAL T-SHIRT",
          priceUSD: 38.99,
          img: "assets/images/products/wolf-teal-floral.jpg",
          link: "https://mrcharliestxs.myshopify.com/products/wolf-wave-graphic-t-shirt-teal-floral-wolf-design?variant=43781864914995",
          sliderIndex: 0
        },
        {
          key: "samurai-moon",
          name: "SAMURAI MOON T-SHIRT",
          priceUSD: 25.73,
          img: "assets/images/products/samurai-moon.jpg",
          link: "https://mrcharliestxs.myshopify.com/products/samurai-moon-graphic-t-shirt-shine-back-print?variant=43781765464115",
          sliderIndex: 1
        },
        {
          key: "samurai-kanji-hoodie",
          name: "SAMURAI KANJI HOODIE",
          priceUSD: 30.83,
          img: "assets/images/products/samurai-kanji-hoodie.jpg",
          link: "https://mrcharliestxs.myshopify.com/products/samurai-warrior-hoodie-vintage-japanese-kanji-design?variant=43772208054323",
          sliderIndex: 2
        },
        {
          key: "gingerbread-sweatshirt",
          name: "CHRISTMAS GINGERBREAD SWEATSHIRT",
          priceUSD: 62.59,
          img: "assets/images/products/gingerbread-sweatshirt.jpg",
          link: "https://mrcharliestxs.myshopify.com/products/christmas-gingerbread-crewneck-sweatshirt-its-the-sweetest-time-of-the-year?variant=43781849317427",
          sliderIndex: 3
        }
      ];

      // slider items only
      const sliderProducts = products.filter(p => typeof p.sliderIndex === "number").sort((a,b)=>a.sliderIndex-b.sliderIndex);
      sliderProducts.forEach(p => { const img = new Image(); img.src = p.img; });

      let ownCurrent = 0;
      let ownTimer = null;

      function stopOwnAuto() {
        if (ownTimer) { clearInterval(ownTimer); ownTimer = null; }
      }

      function startOwnAuto() {
        stopOwnAuto();
        ownTimer = setInterval(() => showSlide(ownCurrent + 1), 5200);
      }

      function showSlide(i) {
        if (!ownImg || !ownName || !ownPrice || !ownLink || !ownCard) return;

        ownCurrent = (i + sliderProducts.length) % sliderProducts.length;

        ownDots.forEach(d => d.classList.remove("active"));
        if (ownDots[ownCurrent]) ownDots[ownCurrent].classList.add("active");

        ownCard.classList.add("own-fade");
        setTimeout(() => {
          const p = sliderProducts[ownCurrent];
          ownImg.src = p.img;
          ownImg.alt = p.name;
          ownName.textContent = p.name;
          ownLink.href = p.link;

          // update currency base
          ownPrice.dataset.usd = String(p.priceUSD);
          renderMoneyAll();

          ownCard.classList.remove("own-fade");
        }, 250);
      }

      // expose for Search
      function jumpToSliderProduct(sliderIndex) {
        showSlide(sliderIndex);
        const ownSection = document.getElementById("own-look");
        if (ownSection) ownSection.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      ownDots.forEach((dot, i) => { dot.onclick = () => { showSlide(i); startOwnAuto(); }; });
      if (ownPrev) ownPrev.onclick = () => { showSlide(ownCurrent - 1); startOwnAuto(); };
      if (ownNext) ownNext.onclick = () => { showSlide(ownCurrent + 1); startOwnAuto(); };

      // swipe
      let startX = 0, startY = 0, isSwiping = false;

      function onTouchStart(e) {
        const t = e.touches[0];
        startX = t.clientX; startY = t.clientY; isSwiping = true;
      }

      function onTouchMove(e) {
        if (!isSwiping) return;
        const t = e.touches[0];
        const dx = t.clientX - startX;
        const dy = t.clientY - startY;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 18) e.preventDefault();
      }

      function onTouchEnd(e) {
        if (!isSwiping) return;
        isSwiping = false;
        const t = e.changedTouches[0];
        const dx = t.clientX - startX;
        const dy = t.clientY - startY;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 40) {
          if (dx < 0) showSlide(ownCurrent + 1);
          else showSlide(ownCurrent - 1);
          startOwnAuto();
        }
      }

      if (swipeArea) {
        swipeArea.addEventListener("touchstart", onTouchStart, { passive: true });
        swipeArea.addEventListener("touchmove", onTouchMove, { passive: false });
        swipeArea.addEventListener("touchend", onTouchEnd, { passive: true });
      }

      showSlide(0);
      startOwnAuto();

      /* ========================= */
      /* CHAT PANEL                */
      /* ========================= */
      const chatPanel = document.getElementById("chatPanel");
      const chatOpenBtn = document.getElementById("chatOpenBtn");
      const chatCloseBtn = document.getElementById("chatCloseBtn");

      function openChat() {
        if (!chatPanel) return;
        chatPanel.classList.add("open");
        chatPanel.setAttribute("aria-hidden", "false");
      }

      function closeChat() {
        if (!chatPanel) return;
        chatPanel.classList.remove("open");
        chatPanel.setAttribute("aria-hidden", "true");
      }

      if (chatOpenBtn) chatOpenBtn.addEventListener("click", openChat);
      if (chatCloseBtn) chatCloseBtn.addEventListener("click", closeChat);

      /* ========================= */
      /* CURRENCY (USD / NGN)      */
      /* ========================= */
      // Default fallback rate (works offline)
      let NGN_RATE = 1500; // fallback

      // Optional: auto-update rate (no keys). If it fails, fallback stays.
      // You can remove this fetch if you want manual rate only.
      fetch("https://open.er-api.com/v6/latest/USD")
        .then(r => r.json())
        .then(data => {
          if (data && data.result === "success" && data.rates && data.rates.NGN) {
            NGN_RATE = Number(data.rates.NGN) || NGN_RATE;
            renderMoneyAll();
          }
        })
        .catch(() => { /* keep fallback */ });

      let activeCurrency = "USD";
      const currencyBtns = document.querySelectorAll(".currency-btn");

      function formatMoneyUSD(v) { return `$${v.toFixed(2)}`; }
      function formatMoneyNGN(v) { return `‚Ç¶${Math.round(v).toLocaleString("en-NG")}`; }

      function renderMoneyAll() {
        const moneyEls = document.querySelectorAll("[data-money][data-usd]");
        moneyEls.forEach(el => {
          const usd = Number(el.dataset.usd || "0");
          el.textContent = (activeCurrency === "USD")
            ? formatMoneyUSD(usd)
            : formatMoneyNGN(usd * NGN_RATE);
        });
      }

      currencyBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          currencyBtns.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          activeCurrency = btn.dataset.currency || "USD";
          renderMoneyAll();
        });
      });

      renderMoneyAll();

      /* ========================= */
      /* ‚úÖ SEARCH (WORKING)       */
      /* - shows results           */
      /* - "view on page" scrolls  */
      /* - Shopify link opens shop */
      /* ========================= */
      const searchBtn = document.getElementById("searchBtn");
      const searchOverlay = document.getElementById("searchOverlay");
      const searchModal = document.getElementById("searchModal");
      const searchInput = document.getElementById("searchInput");
      const searchResults = document.getElementById("searchResults");

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      function openSearch() {
        if (!searchOverlay || !searchModal || !searchInput) return;
        searchOverlay.classList.add("open");
        searchModal.classList.add("open");
        searchOverlay.setAttribute("aria-hidden", "false");
        searchModal.setAttribute("aria-hidden", "false");
        searchInput.value = "";
        renderSearchResults("");
        setTimeout(() => searchInput.focus(), 30);
      }

      function closeSearch() {
        if (!searchOverlay || !searchModal) return;
        searchOverlay.classList.remove("open");
        searchModal.classList.remove("open");
        searchOverlay.setAttribute("aria-hidden", "true");
        searchModal.setAttribute("aria-hidden", "true");
      }

      function renderSearchResults(query) {
        if (!searchResults) return;

        const q = (query || "").trim().toLowerCase();
        const matches = !q
          ? products.slice(0, 6)
          : products.filter(p => p.name.toLowerCase().includes(q) || (p.key && p.key.includes(q)));

        if (!matches.length) {
          searchResults.innerHTML = `<div style="padding:10px 2px; font-size:13px;">No results found.</div>`;
          return;
        }

        searchResults.innerHTML = matches.map(p => {
          const priceText = (activeCurrency === "USD")
            ? `$${p.priceUSD.toFixed(2)}`
            : `‚Ç¶${Math.round(p.priceUSD * NGN_RATE).toLocaleString("en-NG")}`;

          // view target: either onPageId or sliderIndex
          const viewTarget = p.onPageId ? `page:${p.onPageId}` : (typeof p.sliderIndex === "number" ? `slider:${p.sliderIndex}` : "");

          return `
            <div class="search-result" role="group" aria-label="${escapeHtml(p.name)}">
              <div class="search-thumb">
                <img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" loading="lazy">
              </div>
              <div class="search-meta" style="flex:1;">
                <div class="search-name">${escapeHtml(p.name)}</div>
                <div class="search-price">${escapeHtml(priceText)}</div>

                <div style="display:flex; gap:10px; margin-top:8px; flex-wrap:wrap;">
                  <button
                    type="button"
                    class="icon-btn"
                    style="border:1px solid #111; padding:8px 10px; border-radius:12px; font-size:12px; letter-spacing:1px;"
                    data-view="${escapeHtml(viewTarget)}"
                  >View on page</button>

                  <a
                    class="icon-btn"
                    style="border:1px solid #111; padding:8px 10px; border-radius:12px; font-size:12px; letter-spacing:1px;"
                    href="${escapeHtml(p.link)}"
                    target="_blank"
                    rel="noopener"
                  >Open on Shopify</a>
                </div>
              </div>
            </div>
          `;
        }).join("");

        // bind view buttons
        searchResults.querySelectorAll("button[data-view]").forEach(btn => {
          btn.addEventListener("click", () => {
            const v = btn.getAttribute("data-view") || "";
            closeSearch();

            if (v.startsWith("page:")) {
              const id = v.replace("page:", "");
              const el = document.getElementById(id);
              if (el) {
                el.scrollIntoView({ behavior: "smooth", block: "center" });
                // quick highlight effect
                el.style.outline = "2px solid #111";
                el.style.outlineOffset = "8px";
                setTimeout(() => { el.style.outline = "none"; el.style.outlineOffset = "0"; }, 1100);
              }
            } else if (v.startsWith("slider:")) {
              const idx = Number(v.replace("slider:", ""));
              if (!Number.isNaN(idx)) jumpToSliderProduct(idx);
            }
          });
        });
      }

      if (searchBtn) searchBtn.addEventListener("click", openSearch);
      if (searchOverlay) searchOverlay.addEventListener("click", closeSearch);

      if (searchInput) {
        searchInput.addEventListener("input", (e) => {
          renderSearchResults(e.target.value);
        });

        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Escape") closeSearch();
        });
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          closeSearch();
          closeChat();
        }
      });

      /* ========================= */
      /* PAUSE WHEN TAB HIDDEN     */
      /* ========================= */
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          stopOwnAuto();
          stopHeroAuto();
        } else {
          startOwnAuto();
          startHeroAuto();
        }
      });

    });
  </script>

</body>
</html>
